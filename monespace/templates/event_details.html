{% extends "base.html" %}
{% load static %}

{% block script %}
<script src= "{% static 'scripts/scripts_event_attendee.js' %}"></script>
{% endblock %}


{% block content %}


    <div class="sub_nav">
      {% if manager_location or request.user.user_type == 1 %}
        <div class="sub_nav_item">
            <span><img src="{% static 'images/arrow.svg' %}" alt="Les Restos du Cœur">
                {% if event.is_recurring %}
                <a href="{% url 'event_edit' event_id=event.id %}?date={{date}}">Modifier l'évenement REC</a>
                {% else %}
                <a href="{% url 'event_edit' event_id=event.id %}">Modifier l'évenement</a>
                {% endif %}
            </span>
        </div>
        {% endif %}
        <div class="sub_nav_item">
            <span><img src="{% static 'images/arrow.svg' %}" alt="Les Restos du Cœur"><a id="event_attendees_list"></a>: {{count_attendees}} personnes</span>
        </div>
    </div>


<div class="event_details_master">

  <div class="event_details">

    <div class="event_left">
        <h2>{{ event.name }}</h2>
        <p>{{ event.description }}</p>
    </div>


    <div class="event_right">

      <div class="event_right_subitem">
        <div class="event_right_subitem_box">
        <i class="far fa-calendar-alt"></i><span class="name_event_right_subitem">DATE</span>
            {% if event.is_recurring %}
            <p>{{ date }}</p>
            {% elif event.start_date != event.end_date and event.end_date is not none %}
            <p>du {{ event.start_date }} au {{ event.end_date }}</p>
            {% else %}
            <p>{{ event.start_date }}</p>
            {% endif %}
        </div>
      </div>

      <div class="event_right_subitem">
        <div class="event_right_subitem_box">
        <i class="far fa-clock"></i><span class="name_event_right_subitem">HEURE</span>
        <p>de {{ event.time_from }} à {{ event.time_to }}</p>
        </div>
      </div>

      <div class="event_right_subitem">
        <div class="event_right_subitem_box">
        <i class="fas fa-map-marker-alt"></i><span class="name_event_right_subitem">LIEU</span>
        <p><a href="{% url 'location_details' location_id=event.location.id %}">{{ event.location }}</a></p>
        <p>{{ event.location.address }} - {{ event.location.zipcode }} - {{ event.location.city }}</p>
        </div>
      </div>

      <div class="event_right_subitem_attend">
        {% now "Y-m-d" as todays_date %}
            {% if todays_date <= date %}

            {% if attendees %}
            <form>
              {% csrf_token %}
              <button class="button_attendees button_white" data-type="decline" type='submit' data-eventid="{{event.id}}" data-date="{{date}}">Annuler ma venue</button>
            </form>
            {% else %}
            <form>
              {% csrf_token %}
              <button class="button_attendees" data-type="attend" type='submit' data-eventid="{{event.id}}" data-date="{{date}}">Je serai là</button>
            </form>
            {% endif %}
            {% endif %}
      </div>

        {% if attendees and todays_date <= date  %}
      <div class="event_right_subitem_attend">
          <form>
            <label for="plus_other">Venez vous avez d'autres personnes? Entrez le nombre de personnes vous accompagnant</label>
            <input type="number" id="plus_other" name="plus_other" value="{{attendees.plus_other}}"  min="0" data-eventid="{{event.id}}" data-date="{{date}}">
        </form>
      </div>
        {% endif %}

      </div>

  </div>

    {% if event.was_recurring_event_rec %}
        <p class="info_text">Ceci est un événement provenant d'une récurrence mais modifié pour cette date specifiquement</p>
    {% elif not event.is_recurring %}
    <p class="info_text">Ceci est un événement non recurrent</p>
    {% endif %}
</div>


<div class="event_attendees_list">
  {% for i in all_attendees%}
    <p>{{i.user}}
    {% if i.plus_other > 0%} --> Vient avec {{i.plus_other}} personnes</p>{% endif %}
  {% endfor %}
</div>



{% if todays_date <= date %}
      {% if manager_location or request.user.user_type == 1 %}
    <div class="sub_nav">
        {% if event.is_recurring %}
        <div class="sub_nav_item">
            <span><img src="{% static 'images/arrow.svg' %}" alt="Les Restos du Cœur"><a href="{% url 'event_delete_rec' event_id=event.pk %}?date={{date}}">Annuler cette date</a></span>
        </div>
        <div class="sub_nav_item">
            <span><img src="{% static 'images/arrow.svg' %}" alt="Les Restos du Cœur"><a href="{% url 'event_delete_all' event_id=event.pk %}">Annuler toutes les dates</a></span>
        </div>
        {% else %}
        <div class="sub_nav_item">
            <span><img src="{% static 'images/arrow.svg' %}" alt="Les Restos du Cœur"><a href="{% url 'event_delete_all' event_id=event.pk %}">Annuler cette date</a></span>
        </div>
        {% endif %}
    </div>
        {% endif %}
{% endif %}


{% endblock %}
