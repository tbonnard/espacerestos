{% extends "base.html" %}
{% load static %}


{% block script %}
<script src= "{% static 'scripts/location_details.js' %}"></script>
{% endblock %}

{% block content %}

{% if manager_location or request.user.user_type == 1 %}
<div class="top_bar_menu">

    <div class="sub_nav_hor active" id="location_details_menu">
        <i class="fas fa-map-marker-alt"></i>Détails du site
    </div>

    <a href="{% url 'location_edit' location_id=location.pk %}">
        <div class="sub_nav_hor">
        <i class="fas fa-edit"></i>Modifier le site
        </div>
    </a>

    <a href="{% url 'users_site' location_id=location.pk %}">
        <div class="sub_nav_hor">
        <i class="fas fa-users"></i>Bénévoles du site
        </div>
    </a>

    <div class="sub_nav_hor" id="location_soirees_menu">
        <i class="fas fa-map-marker-alt"></i>Soirées de distribution
    </div>


</div>


{% endif %}

<div class="container_master_mobile">

    <div class="location_global">
        <div class="location_left">
            <h3>Adresse du site de "{{ location.name }}"</h3>
            <p>{{ location.address }}</p>
            <p>{{ location.address_2 }}</p>
            <p>{{ location.city }}</p>
            <p>{{ location.zipcode }}</p>
            <p>{{ location.get_country_display }}</p>
            Site géré par:
            {% for i in location.location_managers.all %}
            <p>{{i}}</p>
            {% endfor %}
        </div>

        <div class="location_right">
            <div class="mapouter">
                <div class="gmap_canvas">
                    <iframe width="600" height="500" id="gmap_canvas" src="https://maps.google.com/maps?q={{location.address}},%20{{location.city}}%20{{location.zip_code}}%20{{location.country}}&t=&z=13&ie=UTF8&iwloc=&output=embed" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe>
                    <a href="https://123movies-to.org"></a>
                    <br>
                    <style>.mapouter{position:relative;text-align:right;height:500px;width:600px;}</style>
                    <a href="https://www.embedgooglemap.net">google maps on websites</a>
                    <style>.gmap_canvas {overflow:hidden;background:none!important;height:500px;width:600px;}</style>
                </div>
            </div>
        </div>
    </div>


    <div id="soirees">

        {% if events|length > 0 %}
        <table class='table1'>
            <thead>
                <tr>
                    <th class='table_heading'>Nom</th>
                    <th class='table_heading'>Journée</th>
                    <th class='table_heading'>Heure</th>
                    <th class='table_heading'>Gestionnaire</th>
                    <th class='table_heading'>Bénévoles actifs</th>
                    <th class='table_heading'>Bénévoles en attente</th>
                    <th class='table_heading'>Annuler toutes les dates futures<i class="fas fa-info-circle info_icon" title="Si une distribution avait des dates passées lors de la l'annulation, elle a ce statut d'annulé. Si aucune date passée, la distribution est supprimée."></i></th>
                </tr>
            </thead>
            <tbody>
            {% for j in events %}
                <tr class="tr_distrib" data-event="{{j.pk}}">
                    <td class='table_cell'><a href="{% url 'distrib_details' distrib_id=j.pk %}" >{{j.name|default_if_none:""}}</a></td>
                    <td class='table_cell'>{{j.start_date|date:'l'}}</td>
                    <td class='table_cell'>{{j.time_from|default_if_none:""}} - {{j.time_to|default_if_none:""}}</td>
                    <td class='table_cell'>{{j.event_manager|default_if_none:""}}</td>
                    <td class='table_cell'></td>
                    <td class='table_cell'></td>
                    {% if j.is_cancelled %}
                    <td class='table_cell' >annulée</td>
                    {% else %}
                    {% if j.event_manager == request.user or request.user.user_type == 1 %}
                    <td class='table_cell' id="div_cancel_validation" data-event="{{j.pk}}"><button class="button_form_status validate_user_status" title="Annuler toutes les futures dates" data-type="edit" data-event="{{j.pk}}"><i class="far fa-trash-alt"></i></button></td>
                    {% else %}
                    <td class='table_cell'><i class="fas fa-info-circle info_icon" title="Seul le responsable de la distribution peut annuler"></i></td>
                    {% endif %}
                    {% endif %}

                </tr>
            {% endfor %}
            </tbody>
        </table>

        {% else %}
        <p class="info_text">Aucune soirée de distribution pour ce site</p>
        {% endif %}

        <a href="{% url 'distribution_create' location_id=location.pk %}" >
         <button class=""><i class="fas fa-plus"></i> Distribution</button>
        </a>

    </div>

</div>
{% endblock %}