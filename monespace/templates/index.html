{% extends 'base.html' %}
{% load static %}
{% load tz %}
{% block script %}
<script src= "{% static 'scripts/index.js' %}"></script>
<script src= "{% static 'scripts/scripts_events_attendee.js' %}"></script>
{% endblock %}


{% block content%}

<div class="top_bar_menu">

    {% if request.user.user_type != 2 %}
    <div class="sub_nav_hor" id="events_manager_menu">
        <i class="fas fa-calendar-alt"></i>Distributions à charge
    </div>
    {% endif %}

    <div class="sub_nav_hor active" id="events_14_days_menu">
        <i class="fas fa-user-check"></i>Présences
    </div>

    <div class="sub_nav_hor" id="messages_menu">
        {% csrf_token %}
        <i class="fas fa-envelope"></i>Messages
        <div id="notification_messages_top" class="notification_messages"><span class="dot"></span></div>
    </div>


</div>

<div class="container_master">
<div class="container_master_mobile">

    {% if request.user.user_type != 2 %}
    {% csrf_token %}
    <div id="events_manager">

        {% if users_to_approve %}
        <p class="info_text">Certain(s) bénévole(s) en attente d'approbation. Cliquer <a href="{% url 'distrib_users' distrib_id=distrib_users_to_approve %}">ici</a></p>
        {% endif %}

        <p class="info_text" id="no_distrib">Aucune soirée de distribution à votre charge</p>

        <table class='table1'>
            <thead>
                <tr>
                    <th class='table_heading'>Date</th>
                    <th class='table_heading'>Nom</th>
                    <th class='table_heading'>Heure</th>
                    <th class='table_heading'>Bénévoles présents</th>
                    <th class='table_heading'>Envoyer un message</th>
                    <th class='table_heading'>Annuler cette date</th>
                </tr>
            </thead>
            <tbody id="tbody_event_manager">
            {% for j in events_manager %}
            {% for z in j.1 %}

            {% endfor %}
            {% endfor %}
            </tbody>
        </table>


        <div class="view_more_event_manager">
            <button id='button_event_manager_load' data-ideventsearch="{{request.user.uuid}}" class="button_white">Voir plus</button>
        </div>

    </div>
    {% endif %}


<div id="events_14_days">

{% if pending_events %}
        <p class="info_text">Vous avez au moins un site en attente de confirmation par le responsable de la soirée:
            {%for i in pending_events %}
            {{i.distrib }}
            {% endfor %}
        </p>
{% endif %}


{% if events|length == 0 %}
    <p class="info_text">Aucune présence prévue pour vous dans les 14 prochains jours</p>
{% else %}

<h3>Vos présences des 14 prochains jours</h3>

{% include "events_loop.html" %}

{% endif %}

    <div class="">
        <a href="{% url 'events_list_date'%}?from={% now 'Y-m-d' %}&to={{date_to|date:'Y-m-d'}}" >
            <button class="button_white">Voir plus de distributions</button>
        </a>
    </div>


</div>


<div id="messages">

    <div id="messages_sub_menu">
    <a id="a_received_messages" class="active">Messages reçus</a>
    <a id="a_sent_messages">Messages envoyés</a>
    </div>

    <div id="received_messages">
        {% if to_user_messages|length == 0 %}
        <p class="info_text">Aucun message reçu</p>
        {% else %}
        {% for i in to_user_messages %}

        <div class="message_div">

            <div class="message_unit_div" data-message="{{i.uuid}}">

                <div class="message__line_unit_div">
                    <div class="table_heading_message_div">Envoyé par</div>
                    <div class="message_nav_line_details_div">{% if i.from_user == request.user  %}
                            Vous
                            {% else %}
                            {{i.from_user}}
                            {% endif %}
                    </div>
                </div>

                <div class="message__line_unit_div">
                    <div class='table_heading_message_div'>Pour le site</div>
                    <div class="message_nav_line_details_div">{{i.to_location|default_if_none:"/"}}</div>
                </div>

                <div class="message__line_unit_div">
                    <div class='table_heading_message_div'>Pour la distribution</div>
                    <div class="message_nav_line_details_div">{{i.to_event|default_if_none:"/"}}</div>
                </div>

                <div class="message__line_unit_div">
                    <div class='table_heading_message_div'>De la date du</div>
                    <div class="message_nav_line_details_div">{{i.to_event_date|default_if_none:"/"}}</div>
                </div>


                <div class="message__line_unit_div">
                    <div class='table_heading_message_div'>Envoyé à</div>
                    <div class="message_nav_line_details_div">
                    {% if i.to_user == request.user  %}
                    A vous
                    {% elif i.to_user %}
                        {{ i.to_user }}
                        {% else %}
                    {{i.get_to_event_group_display|default_if_none:"/"}}
                    {% endif %}
                    </div>
                </div>

                <div class="message__line_unit_div">
                    <div class='table_heading_message_div'>Envoyé le</div>

                    <div class="message_nav_line_details_div">
                        {% timezone "Europe/Paris" %}
                        {{ i.created }}
                        {% endtimezone %}
                    </div>
                </div>


            </div>

            <div class="message_description_div" data-loc="{{j.uuid}}">
                <span class="message_nav_line_description_div">{{i.description}}</span>
            </div>

            <span class="notification_messages_solo_div" data-message="{{i.uuid}}">
                <span class="dot"  title="Marquer comme lu">
                </span>
            </span>

        </div>


<!--        <div class="pre_table_notif">-->
<!--        <table class='table1_message'>-->
<!--            <thead class="message_unit" data-message="{{i.uuid}}">-->
<!--                <tr>-->
<!--                    <th class='table_heading_message'>Envoyé par<p class="message_nav_line_details">-->
<!--                        {% if i.from_user == request.user  %}-->
<!--                        Vous-->
<!--                        {% else %}-->
<!--                        {{i.from_user}}-->
<!--                        {% endif %}-->
<!--                    </p></th>-->
<!--                    <th class='table_heading_message'>Pour le site<p class="message_nav_line_details">{{i.to_location|default_if_none:"/"}}</p></th>-->
<!--                    <th class='table_heading_message'>Pour la distribution<p class="message_nav_line_details">{{i.to_event|default_if_none:"/"}}</p></th>-->
<!--                    <th class='table_heading_message'>De la date du<p class="message_nav_line_details">{{i.to_event_date|default_if_none:"/"}}</p></th>-->
<!--                    <th class='table_heading_message'>Envoyé à<p class="message_nav_line_details">-->
<!--                    {% if i.to_user == request.user  %}-->
<!--                    A vous-->
<!--                    {% elif i.to_user %}-->
<!--                        {{ i.to_user }}-->
<!--                        {% else %}-->
<!--                    {{i.get_to_event_group_display|default_if_none:"/"}}-->
<!--                    {% endif %}-->
<!--                </p></th>-->
<!--                    <th class='table_heading_message'>Envoyé le<p class="message_nav_line_details">{{i.created}}</p></th>-->
<!--                    <th><span class="notification_messages_solo" data-message="{{i.uuid}}"><span class="dot"  title="Marquer comme lu"></span></span></th>-->
<!--                </tr>-->
<!--            </thead>-->
<!--            <tbody>-->
<!--                <tr>-->
<!--                    <td class="td_row" colspan="6" data-loc="{{j.uuid}}">-->
<!--                        <span class="message_nav_line_description">{{i.description}}</span>-->
<!--                    </td>-->
<!--                </tr>-->
<!--            </tbody>-->
<!--        </table>-->
<!--        </div>-->

        {% endfor %}
        {% endif %}
    </div>



      <div id="sent_messages">
        {% if from_user_messages|length == 0 %}
        <p class="info_text">Aucun message envoyé</p>
        {% else %}
          {% for i in from_user_messages %}

          <div class="message_div">

            <div class="message_unit_div" data-message="{{i.uuid}}">

                <div class="message__line_unit_div">
                    <div class="table_heading_message_div">Envoyé par</div>
                    <div class="message_nav_line_details_div">{% if i.from_user == request.user  %}
                            Vous
                            {% else %}
                            {{i.from_user}}
                            {% endif %}
                    </div>
                </div>

                <div class="message__line_unit_div">
                    <div class='table_heading_message_div'>Pour le site</div>
                    <div class="message_nav_line_details_div">{{i.to_location|default_if_none:"/"}}</div>
                </div>

                <div class="message__line_unit_div">
                    <div class='table_heading_message_div'>Pour la distribution</div>
                    <div class="message_nav_line_details_div">{{i.to_event|default_if_none:"/"}}</div>
                </div>

                <div class="message__line_unit_div">
                    <div class='table_heading_message_div'>De la date du</div>
                    <div class="message_nav_line_details_div">{{i.to_event_date|default_if_none:"/"}}</div>
                </div>


                <div class="message__line_unit_div">
                    <div class='table_heading_message_div'>Envoyé à</div>
                    <div class="message_nav_line_details_div">
                    {% if i.to_user == request.user  %}
                    A vous
                    {% elif i.to_user %}
                        {{ i.to_user }}
                        {% else %}
                    {{i.get_to_event_group_display|default_if_none:"/"}}
                    {% endif %}
                    </div>
                </div>

                <div class="message__line_unit_div">
                    <div class='table_heading_message_div'>Envoyé le</div>
                    <div class="message_nav_line_details_div">
                        {% timezone "Europe/Paris" %}
                        {{ i.created }}
                        {% endtimezone %}
                    </div>
                </div>


            </div>

            <div class="message_description_div" data-loc="{{j.uuid}}">
                <span class="message_nav_line_description_div">{{i.description}}</span>
            </div>


        </div>








<!--          -->
<!--          -->
<!--        <table class='table1_message'>-->
<!--            <thead>-->
<!--                <tr>-->
<!--                    <th class='table_heading_message'>Envoyé par<p class="message_nav_line_details">-->
<!--                        {% if i.from_user == request.user  %}-->
<!--                        Vous-->
<!--                        {% else %}-->
<!--                        {{i.from_user}}-->
<!--                        {% endif %}-->
<!--                    </p></th>-->
<!--                    <th class='table_heading_message'>Pour le site<p class="message_nav_line_details">{{i.to_location|default_if_none:"/"}}</p></th>-->
<!--                    <th class='table_heading_message'>Pour la distribution<p class="message_nav_line_details">{{i.to_event|default_if_none:"/"}}</p></th>-->
<!--                    <th class='table_heading_message'>De la date du<p class="message_nav_line_details">{{i.to_event_date|default_if_none:"/"}}</p></th>-->
<!--                    <th class='table_heading_message'>Envoyé à<p class="message_nav_line_details">-->
<!--                    {% if i.to_user == request.user  %}-->
<!--                    A vous-->
<!--                    {% elif i.to_user %}-->
<!--                        {{ i.to_user }}-->
<!--                        {% else %}-->
<!--                    {{i.get_to_event_group_display|default_if_none:"/"}}-->
<!--                    {% endif %}-->
<!--                </p></th>-->
<!--                    <th></th>-->
<!--                </tr>-->
<!--            </thead>-->
<!--            <tbody>-->
<!--                <tr>-->
<!--                    <td class="td_row" colspan="6" data-loc="{{j.uuid}}">-->
<!--                        <span class="message_nav_line_description">{{i.description}}</span>-->
<!--                    </td>-->
<!--                </tr>-->
<!--            </tbody>-->
<!--        </table>-->



        {% endfor %}
        {% endif %}
        </div>

</div>


<div id="send_messages_global">
    {% include 'send_messages.html' %}
</div>



</div>
</div>
{% endblock %}