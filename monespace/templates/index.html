{% extends 'base.html' %}
{% load static %}

{% block script %}
<script src= "{% static 'scripts/index.js' %}"></script>
<script src= "{% static 'scripts/scripts_events_attendee.js' %}"></script>
{% endblock %}


{% block content%}

<div class="top_bar_menu">

    {% if request.user.user_type != 2 %}
    <div class="sub_nav_hor" id="events_manager_menu">
        <i class="fas fa-calendar-alt"></i>Distributions à charge
    </div>
    {% endif %}

    <div class="sub_nav_hor active" id="events_14_days_menu">
        <i class="fas fa-user-check"></i>Présences
    </div>

    <div class="sub_nav_hor" id="messages_menu">
        {% csrf_token %}
        <i class="fas fa-envelope"></i>Messages
        <div id="notification_messages_top" class="notification_messages"><span class="dot"></span></div>
    </div>


</div>

<div class="container_master">

<div class="container_master_mobile">

    {% if request.user.user_type != 2 %}
    {% csrf_token %}
    <div id="events_manager">

        <p class="info_text">Aucune soirée de distribution à votre charge</p>

        <table class='table1'>
            <thead>
                <tr>
                    <th class='table_heading'>Date</th>
                    <th class='table_heading'>Nom</th>
                    <th class='table_heading'>Heure</th>
                    <th class='table_heading'>Bénévoles présents</th>
                    <th class='table_heading'>Envoyer un message</th>
                    <th class='table_heading'>Annuler cette date</th>
                </tr>
            </thead>
            <tbody id="tbody_event_manager">
            {% for j in events_manager %}
            {% for z in j.1 %}

            {% endfor %}
            {% endfor %}
            </tbody>
        </table>


        <div class="view_more_event_manager">
            <button id='button_event_manager_load' data-ideventsearch="{{request.user.uuid}}" class="button_white">Voir plus</button>
        </div>

    </div>
    {% endif %}


<div id="events_14_days">

{% if pending_events %}
        <p class="info_text">Vous avez au moins un site en attente de confirmation par le responsable de la soirée:
            {%for i in pending_events %}
            {{i.distrib }}
            {% endfor %}
        </p>
{% endif %}


{% if events|length == 0 %}
    <p class="info_text">Aucune présence prévue pour vous dans les 14 prochains jours</p>
{% else %}

<h3>Vos présences des 14 prochains jours</h3>

{% include "events_loop.html" %}

{% endif %}

            <div class="">
                <a href="{% url 'events_list_date'%}?from={% now 'Y-m-d' %}&to={{date_to|date:'Y-m-d'}}" >
                    <button class="button_white">Voir plus de distributions</button>
                </a>
            </div>


</div>


<div id="messages">

    <div id="messages_sub_menu">
    <a id="a_received_messages" class="active"><h3>Message reçu</h3></a>
    <a id="a_sent_messages"><h3>Message envoyé</h3></a>
    </div>

    <div id="received_messages">
        {% if to_user_messages|length == 0 %}
        <p class="info_text">Aucun message reçu</p>
        {% else %}
        {% for i in to_user_messages %}
        <div class="message_unit" data-message="{{i.uuid}}">
            <div class="notification_messages_solo" data-message="{{i.uuid}}"><span class="dot"  title="Marquer comme lu"></span></div>
            <div class="message_nav_line">
                <div class="message_nav_line_title">Envoyé par<p class="message_nav_line_details">{{i.from_user}}</p></div>
                <div class="message_nav_line_title">Pour le site<p class="message_nav_line_details">{{i.to_location|default_if_none:""}}</p></div>
                <div class="message_nav_line_title">Pour la distribution<p class="message_nav_line_details">{{i.to_event|default_if_none:""}}</p></div>
                <div class="message_nav_line_title">De la date du<p class="message_nav_line_details">{{i.to_event_date|default_if_none:""}}</p></div>
                <div class="message_nav_line_title">Envoyé<p class="message_nav_line_details">
                    {% if i.to_user %}
                    A vous
                    {% else %}
                    {{i.get_to_event_group_display|default_if_none:""}}
                    {% endif %}
                </p></div>
            </div>
            <div class="message_nav_line_description">
                {{i.description}}
            </div>
        </div>
        {% endfor %}
        {% endif %}
    </div>

      <div id="sent_messages">
        {% if from_user_messages|length == 0 %}
        <p class="info_text">Aucun message envoyé</p>
        {% else %}
          {% for i in from_user_messages %}
          <div class="message_unit">
            <div class="message_nav_line">
                <div class="message_nav_line_title">Envoyé par<p class="message_nav_line_details">{{i.from_user}}</p></div>
                <div class="message_nav_line_title">Pour le site<p class="message_nav_line_details">{{i.to_location|default_if_none:""}}</p></div>
                <div class="message_nav_line_title">Pour la distribution<p class="message_nav_line_details">{{i.to_event|default_if_none:""}}</p></div>
                <div class="message_nav_line_title">De la date du<p class="message_nav_line_details">{{i.to_event_date|default_if_none:""}}</p></div>
                <div class="message_nav_line_title">Envoyé<p class="message_nav_line_details">
                    {% if i.to_user %}
                    A vous
                    {% else %}
                    {{i.get_to_event_group_display|default_if_none:""}}
                    {% endif %}
                </p></div>
            </div>
            <div class="message_nav_line_description">
                {{i.description}}
            </div>
        </div>
          {% endfor %}
        {% endif %}
    </div>


</div>


<div id="send_messages_global">
    {% include 'send_messages.html' %}
</div>



</div>
</div>
{% endblock %}